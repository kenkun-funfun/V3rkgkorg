import { createSignal } from 'solid-js';

export type Lang = 'ja' | 'en';

// ✅ 初期言語を決定（localStorage優先 → ブラウザ設定）
function detectInitialLang(): Lang {
    const stored = localStorage.getItem('lang');
    if (stored === 'ja' || stored === 'en') return stored;
    const browserLang = navigator.language.toLowerCase();
    return browserLang.startsWith('ja') ? 'ja' : 'en';
}

// ✅ Signal定義
const [lang, setLangSignal] = createSignal<Lang>(detectInitialLang());

// ✅ 外部用 setter（localStorage保存付き）
export function setLang(newLang: Lang) {
    localStorage.setItem('lang', newLang);
    setLangSignal(newLang);
}

export { lang };

// ✅ 翻訳辞書（必要に応じて追加）
export const i18n = {
    ja: {
        play: '再生する',
        pause: '一時停止',
        reset: 'リセット',
        flipX: '左右反転',
        flipY: '上下反転',
        filter: 'フィルター',
        delete: '削除',
        language: '言語',
        ja: '日本語',
        en: '英語',
        wait_select_category: 'カテゴリを選択してください',
        wait_select_category_button: 'カテゴリを選択する',
        wait_timer_label: 'タイマー（分:秒）',
        wait_max_plays: '再生枚数',
        wait_enable_shuffle: 'シャッフル再生',
        wait_enable_keyboard: 'キーボード操作',
        wait_enable_tap: 'タップ操作',
        wait_chime_label: "10秒前通知音",
        wait_countdown_label: 'カウントダウン',
        wait_countdown_seconds: 'カウントダウン秒数',
        minutes: '分',
        seconds: '秒',
        header_category_manage: 'カテゴリ管理',
        header_play_history: '再生履歴',
        header_remaining: '残り',
        category_panel_title: 'カテゴリ',
        category_panel_search_placeholder: 'カテゴリ検索...',
        category_panel_clear_search: '検索をクリア',
        category_panel_pin: 'ピン',
        category_panel_close: '閉じる',
        filter_panel_title: 'フィルター設定',
        filter_panel_color_mode: 'カラー切替',
        filter_color_normal: 'カラー',
        filter_color_grayscale: 'グレースケール',
        filter_color_sepia: 'セピア',
        filter_panel_brightness: '明るさ',
        filter_panel_close: '閉じる',
        play_paused: '一時停止',
        play_back_to_play: 'ホーム',
        play_category_manage: 'カテゴリ管理',
        play_select_category: 'カテゴリを選択してください',
        play_deleted: '画像を削除しました',
        delete_title: '画像の削除',
        delete_confirm_message: 'この画像を削除しますか？',
        delete_notice: '削除後に JSON を保存すると、この画像は表示されなくなります。',
        delete_cancel: 'キャンセル',
        delete_confirm: '削除する',
        image_display_unavailable: 'RKGK.ORG',
        category_add_title: 'カテゴリ追加',
        category_add_placeholder: '新しいカテゴリ名',
        category_add_button: '追加',
        category_list_load: 'JSON読み込み',
        category_list_save: 'JSON保存',
        category_list_add: 'カテゴリ追加',
        category_list_duplicates: '重複画像の削除',
        category_list_search_placeholder: 'カテゴリ検索...',
        category_list_delete_confirm: '「{name}」を削除しますか？',
        duplicate_title: '重複画像の削除',
        duplicate_not_found: '重複は見つかりませんでした。',
        duplicate_found_message: '重複する画像を発見しました！',
        duplicate_remove_button: '削除する',
        duplicate_removed_suffix: '件の画像を削除しました。',
        duplicate_removed_unit: '枚削除',
        save_title: 'カテゴリデータ保存',
        save_description: '現在のカテゴリデータを JSON ファイルとして保存します。',
        save_all: 'すべてを保存する',
        save_by_category: 'カテゴリごとに保存：',
        load_title: 'カテゴリデータ読み込み',
        load_description: 'JSON ファイルを読み込んでカテゴリデータを更新します。',
        load_mode_label: '読み込みモード：',
        load_mode_delete_add: '削除追加',
        load_mode_append: '追加',
        load_mode_rename_add: 'リネーム追加',
        load_mode_reset: '初期化して読込',
        load_progress_working: '処理中...',
        load_progress_done: '完了しました！',
        load_error_invalid: 'JSONの読み込みに失敗しました。形式をご確認ください。',
        load_error_log: 'JSON読み込みエラー:',
        mode_overwrite: '同名カテゴリを削除してから追加します',
        mode_append: '同名カテゴリがあればその中に画像を追加します',
        mode_rename_add: '同名カテゴリがあれば名前を変更して追加します（_2などを付加）',
        mode_reset: '既存のカテゴリをすべて削除してから、JSONの内容を反映します',
        image_upload_no_category: 'カテゴリが選択されていません',
        image_upload_aborted: '停止しました',
        image_upload_processing: '処理中…',
        image_upload_done: '完了しました！',
        image_upload_hint: '画像を追加するにはここをクリック、またはこのページ内にドロップ',
        image_upload_drag_info1: 'ブラウザで表示している画像も、直接ドラッグドロップできます。',
        image_upload_drag_info2: 'ページ全体がドロップ領域です。枠の外でもドロップできます。',
        image_display_count: '表示件数:',
        image_sort_order: '並び順:',
        sort_asc: '昇順',
        sort_desc: '降順',
        prev_page: '前へ',
        next_page: '次へ',
        upload_success_suffix: '枚の画像を追加しました',
        upload_error_suffix: '枚の画像の追加に失敗しました',
        image_display_finished: '終了しました', // ja

    },
    en: {
        play: 'Play',
        pause: 'Pause',
        reset: 'Reset',
        flipX: 'Flip X',
        flipY: 'Flip Y',
        filter: 'Filter',
        delete: 'Delete',
        language: 'Language',
        ja: 'Japanese',
        en: 'English',
        wait_select_category: 'Please select a category',
        wait_select_category_button: 'Select Category',
        wait_timer_label: 'Timer (min:sec)',
        wait_max_plays: 'Number of images',
        wait_enable_shuffle: 'Enable shuffle playback',
        wait_enable_keyboard: 'Enable keyboard controls',
        wait_enable_tap: 'Enable tap controls',
        wait_chime_label: "10-second warning sound",
        wait_countdown_label: 'Countdown',
        wait_countdown_seconds: 'Countdown Seconds',
        minutes: 'min',
        seconds: 'sec',
        header_category_manage: 'Manage Categories',
        header_play_history: 'Playback History',
        header_remaining: 'Time Left',
        category_panel_title: 'Categories',
        category_panel_search_placeholder: 'Search categories...',
        category_panel_clear_search: 'Clear search',
        category_panel_pin: 'Pin',
        category_panel_close: 'Close',
        filter_panel_title: 'Filter Settings',
        filter_panel_color_mode: 'Color Mode',
        filter_color_normal: 'Color',
        filter_color_grayscale: 'Grayscale',
        filter_color_sepia: 'Sepia',
        filter_panel_brightness: 'Brightness',
        filter_panel_close: 'Close',
        play_paused: 'Paused',
        play_back_to_play: 'Home',
        play_category_manage: 'Manage Categories',
        play_select_category: 'Please select a category',
        play_deleted: 'Image deleted',
        delete_title: 'Delete Image',
        delete_confirm_message: 'Do you want to delete this image?',
        delete_notice: 'After saving JSON, this image will no longer appear.',
        delete_cancel: 'Cancel',
        delete_confirm: 'Delete',
        image_display_unavailable: 'RKGK.ORG',
        category_add_title: 'Add Category',
        category_add_placeholder: 'New category name',
        category_add_button: 'Add',
        category_list_load: 'Load JSON',
        category_list_save: 'Save JSON',
        category_list_add: 'Add Category',
        category_list_duplicates: 'Remove Duplicates',
        category_list_search_placeholder: 'Search categories...',
        category_list_delete_confirm: 'Delete "{name}"?',
        duplicate_title: 'Remove Duplicate Images',
        duplicate_not_found: 'No duplicates found.',
        duplicate_found_message: 'Duplicate images have been detected!',
        duplicate_remove_button: 'Delete',
        duplicate_removed_suffix: 'images deleted.',
        duplicate_removed_unit: 'removed',
        save_title: 'Save Category Data',
        save_description: 'Save the current category data as a JSON file.',
        save_all: 'Save All',
        save_by_category: 'Save by Category:',
        load_title: 'Load Category Data',
        load_description: 'Load a JSON file to update category data.',
        load_mode_label: 'Load mode:',
        load_mode_delete_add: 'Delete and Add',
        load_mode_append: 'Append',
        load_mode_rename_add: 'Rename and Add',
        load_mode_reset: 'Reset and Load',
        load_progress_working: 'processing...',
        load_progress_done: 'Completed!',
        load_error_invalid: 'Failed to load JSON. Please check the format.',
        load_error_log: 'JSON Load Error:',
        mode_overwrite: 'Delete and re-add category if it already exists',
        mode_append: 'If the category exists, add images to it (no duplicate check)',
        mode_rename_add: 'If the category exists, rename it and add (e.g., _2)',
        mode_reset: 'Clear all categories and load the JSON data',
        image_upload_no_category: 'No category selected',
        image_upload_aborted: 'Aborted',
        image_upload_processing: 'processing…',
        image_upload_done: 'Done!',
        image_upload_hint: 'Click here or drop images anywhere on the page to upload',
        image_upload_drag_info1: 'You can also drag and drop images shown in your browser.',
        image_upload_drag_info2: 'The entire page is a drop zone, not just the box.',
        image_display_count: 'Items per page:',
        image_sort_order: 'Sort order:',
        sort_asc: 'Ascending',
        sort_desc: 'Descending',
        prev_page: 'Prev',
        next_page: 'Next',
        upload_success_suffix: 'images added',
        upload_error_suffix: 'images failed to add',
        image_display_finished: 'Finished', // en
    },
};

// ✅ 翻訳関数
export function t(key: keyof typeof i18n['ja']) {
    return i18n[lang()][key];
}
