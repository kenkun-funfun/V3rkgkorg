import { createSignal } from 'solid-js';

export type Lang = 'ja' | 'en';

// ✅ 初期言語を決定（localStorage優先 → ブラウザ設定）
function detectInitialLang(): Lang {
    const stored = localStorage.getItem('lang');
    if (stored === 'ja' || stored === 'en') return stored;
    const browserLang = navigator.language.toLowerCase();
    return browserLang.startsWith('ja') ? 'ja' : 'en';
}

// ✅ Signal定義
const [lang, setLangSignal] = createSignal<Lang>(detectInitialLang());

// ✅ 外部用 setter（localStorage保存付き）
export function setLang(newLang: Lang) {
    localStorage.setItem('lang', newLang);
    setLangSignal(newLang);
}

export { lang };

// ✅ 翻訳辞書（必要に応じて追加）
export const i18n = {
    ja: {
        play: '再生する',
        pause: '一時停止',
        reset: 'リセット',
        flipX: '左右反転',
        flipY: '上下反転',
        filter: 'フィルター',
        delete: '削除',
        language: '言語',
        ja: '日本語',
        en: '英語',
        wait_select_category: 'カテゴリを選択してください',
        wait_select_category_button: 'カテゴリを選択する',
        wait_timer_label: 'タイマー（分:秒）',
        wait_max_plays: '再生枚数',
        wait_enable_shuffle: 'シャッフル再生',
        wait_enable_keyboard: 'キーボード操作',
        wait_enable_tap: 'タップ操作',
        wait_chime_label: "10秒前通知音",
        wait_countdown_label: 'カウントダウン',
        wait_countdown_seconds: 'カウントダウン秒数',
        minutes: '分',
        seconds: '秒',
        header_category_manage: 'カテゴリ管理',
        header_play_history: '再生履歴',
        header_remaining: '残り',
        category_panel_title: 'カテゴリ',
        category_panel_search_placeholder: 'カテゴリ検索...',
        category_panel_clear_search: '検索をクリア',
        category_panel_pin: 'ピン',
        category_panel_close: '閉じる',
        filter_panel_title: 'フィルター設定',
        filter_panel_color_mode: 'カラー切替',
        filter_color_normal: 'カラー',
        filter_color_grayscale: 'グレースケール',
        filter_color_sepia: 'セピア',
        filter_panel_brightness: '明るさ',
        filter_panel_close: '閉じる',
        play_paused: '一時停止',
        play_back_to_play: 'ホーム',
        play_category_manage: 'カテゴリ管理',
        play_select_category: 'カテゴリを選択してください',
        play_deleted: '画像を削除しました',
        delete_title: '画像の削除',
        delete_confirm_message: 'この画像を削除しますか？',
        delete_notice: '削除後に JSON を保存すると、この画像は表示されなくなります。',
        delete_cancel: 'キャンセル',
        delete_confirm: '削除する',
        image_display_unavailable: 'RKGK.ORG',
        category_add_title: 'カテゴリ追加',
        category_add_placeholder: '新しいカテゴリ名',
        category_add_button: '追加',
        category_list_load: 'JSON読み込み',
        category_list_save: 'JSON保存',
        category_list_add: 'カテゴリ追加',
        category_list_duplicates: '重複画像の削除',
        category_list_search_placeholder: 'カテゴリ検索...',
        category_list_delete_confirm: '「{name}」を削除しますか？',
        duplicate_title: '重複画像の削除',
        duplicate_not_found: '重複は見つかりませんでした。',
        duplicate_found_message: '重複する画像を発見しました！',
        duplicate_remove_button: '削除する',
        duplicate_removed_suffix: '件の画像を削除しました。',
        duplicate_removed_unit: '枚削除',
        save_title: 'カテゴリデータ保存',
        save_description: '現在のカテゴリデータを JSON ファイルとして保存します。',
        save_all: 'すべてを保存する',
        save_by_category: 'カテゴリごとに保存：',
        load_title: 'カテゴリデータ読み込み',
        load_description: 'JSON ファイルを読み込んでカテゴリデータを更新します。',
        load_mode_label: '読み込みモード：',
        load_mode_delete_add: '削除追加',
        load_mode_append: '追加',
        load_mode_rename_add: 'リネーム追加',
        load_mode_reset: '初期化して読込',
        load_progress_working: '処理中...',
        load_progress_done: '完了しました！',
        load_error_invalid: 'JSONの読み込みに失敗しました。形式をご確認ください。',
        load_error_log: 'JSON読み込みエラー:',
        mode_overwrite: '同名カテゴリを削除してから追加します',
        mode_append: '同名カテゴリがあればその中に画像を追加します',
        mode_rename_add: '同名カテゴリがあれば名前を変更して追加します（_2などを付加）',
        mode_reset: '既存のカテゴリをすべて削除してから、JSONの内容を反映します',
        image_upload_no_category: 'カテゴリが選択されていません',
        image_upload_aborted: '停止しました',
        image_upload_processing: '処理中…',
        image_upload_done: '完了しました！',
        image_upload_hint: '画像を追加するにはここをクリック、またはこのページ内にドロップ',
        image_upload_drag_info1: 'ブラウザで表示している画像も、直接ドラッグドロップできます。',
        image_upload_drag_info2: 'ページ全体がドロップ領域です。枠の外でもドロップできます。',
        image_display_count: '表示件数:',
        image_sort_order: '並び順:',
        sort_asc: '昇順',
        sort_desc: '降順',
        prev_page: '前へ',
        next_page: '次へ',
        upload_success_suffix: '枚の画像を追加しました',
        upload_error_suffix: '枚の画像の追加に失敗しました',
        image_display_finished: '終了しました', // ja
        header_old_version: '旧バージョン',
        feedback_label: 'バグ報告・フィードバック',
        header_document: 'ドキュメント',
        doc_title: 'カテゴリ管理での画像追加方法',
        doc_intro: '画像をポンポン投げ込んでいくことで簡単に追加できます。このページでは、2つの主な追加方法をご紹介します。',
        doc_drop_browser_title: 'ブラウザからの画像ドロップ',
        doc_drop_browser_desc: 'ブラウザ上で表示されている画像を1枚ずつドラッグし、カテゴリ管理画面にドロップすることで追加できます。',
        doc_drop_local_title: 'ローカルフォルダから一括追加',
        doc_drop_local_desc: 'フォルダから複数の画像ファイルを選択し、カテゴリ管理画面にそのままドラッグ＆ドロップすることで、まとめて追加できます。',
        doc_drop_zone_title: 'ページ全体がドロップゾーン',
        doc_drop_zone_desc: 'カテゴリ管理ページのどこにドロップしても画像が追加されるようになっています。便宜上、ドロップ用の枠を表示しているだけです。',
        doc_video_fallback: 'お使いのブラウザは video タグをサポートしていません。',
        doc_play_controls_title: '再生画面のボタン説明',
        doc_play_prev: '戻る：ひとつ前の画像に戻ります。',
        doc_play_next: '次へ：次の画像へ進みます。',
        doc_play_pause: '再生／一時停止：表示中の画像を一時停止・再開します。',
        doc_play_reset: 'リセット：現在の再生をすべてリセットして最初に戻ります。',
        doc_play_flip_x: '反転（横）：画像を左右反転します。',
        doc_play_flip_y: '反転（縦）：画像を上下反転します。',
        doc_play_filter: 'フィルター：白黒やセピア、明るさ調整などの効果をかけます。',
        doc_play_delete: '削除：現在表示中の画像を削除します。カテゴリデータ保存するとき、削除した画像は含まれません。',
        doc_wait_title: '待機画面の設定',
        doc_wait_timer: 'タイマー（分：秒）：各画像の表示時間を分・秒単位で自由に設定可能です。',
        doc_wait_count: '再生枚数：指定した再生枚数の画像が表示されます。',
        doc_wait_countdown: 'カウントダウン：画像を表示する間にカウントダウンを表示します。',
        doc_wait_shuffle: 'シャッフル再生：再生順をランダムにシャッフルできます。',
        doc_wait_keyboard: 'キーボード操作：スペースまたはエンターで一時停止／再開、←→で前後の画像に移動、Escでリセットして待機画面に戻れます。',
        doc_wait_tap: 'タップ操作：画面を左右3分割して、前・次・一時停止を判定します。',
        doc_wait_bell: '10秒前通知音：タイマーの残りが10秒になったとき、小さなベル音で通知します。',
        doc_features_title: '各機能の説明',
        doc_features_pin: 'ピン：よく使うカテゴリをピン留めして、上部に固定表示できます。',
        doc_features_export: 'カテゴリデータ保存：現在の全カテゴリ＋画像データをJSON形式でエクスポートできます。',
        doc_features_import: 'カテゴリデータ読み込み：JSON形式のカテゴリデータを読み込んで復元できます。',
        doc_features_add: 'カテゴリ追加：自由に新しいカテゴリを作成できます。',
        doc_features_dedup: '重複画像の削除：同じ画像データが複数ある場合、自動的に重複を取り除く機能があります。',


    },
    en: {
        play: 'Play',
        pause: 'Pause',
        reset: 'Reset',
        flipX: 'Flip X',
        flipY: 'Flip Y',
        filter: 'Filter',
        delete: 'Delete',
        language: 'Language',
        ja: 'Japanese',
        en: 'English',
        wait_select_category: 'Please select a category',
        wait_select_category_button: 'Select Category',
        wait_timer_label: 'Timer (min:sec)',
        wait_max_plays: 'Number of images',
        wait_enable_shuffle: 'Enable shuffle playback',
        wait_enable_keyboard: 'Enable keyboard controls',
        wait_enable_tap: 'Enable tap controls',
        wait_chime_label: "10-second warning sound",
        wait_countdown_label: 'Countdown',
        wait_countdown_seconds: 'Countdown Seconds',
        minutes: 'min',
        seconds: 'sec',
        header_category_manage: 'Manage Categories',
        header_play_history: 'Playback History',
        header_remaining: 'Time Left',
        category_panel_title: 'Categories',
        category_panel_search_placeholder: 'Search categories...',
        category_panel_clear_search: 'Clear search',
        category_panel_pin: 'Pin',
        category_panel_close: 'Close',
        filter_panel_title: 'Filter Settings',
        filter_panel_color_mode: 'Color Mode',
        filter_color_normal: 'Color',
        filter_color_grayscale: 'Grayscale',
        filter_color_sepia: 'Sepia',
        filter_panel_brightness: 'Brightness',
        filter_panel_close: 'Close',
        play_paused: 'Paused',
        play_back_to_play: 'Home',
        play_category_manage: 'Manage Categories',
        play_select_category: 'Please select a category',
        play_deleted: 'Image deleted',
        delete_title: 'Delete Image',
        delete_confirm_message: 'Do you want to delete this image?',
        delete_notice: 'After saving JSON, this image will no longer appear.',
        delete_cancel: 'Cancel',
        delete_confirm: 'Delete',
        image_display_unavailable: 'RKGK.ORG',
        category_add_title: 'Add Category',
        category_add_placeholder: 'New category name',
        category_add_button: 'Add',
        category_list_load: 'Load JSON',
        category_list_save: 'Save JSON',
        category_list_add: 'Add Category',
        category_list_duplicates: 'Remove Duplicates',
        category_list_search_placeholder: 'Search categories...',
        category_list_delete_confirm: 'Delete "{name}"?',
        duplicate_title: 'Remove Duplicate Images',
        duplicate_not_found: 'No duplicates found.',
        duplicate_found_message: 'Duplicate images have been detected!',
        duplicate_remove_button: 'Delete',
        duplicate_removed_suffix: 'images deleted.',
        duplicate_removed_unit: 'removed',
        save_title: 'Save Category Data',
        save_description: 'Save the current category data as a JSON file.',
        save_all: 'Save All',
        save_by_category: 'Save by Category:',
        load_title: 'Load Category Data',
        load_description: 'Load a JSON file to update category data.',
        load_mode_label: 'Load mode:',
        load_mode_delete_add: 'Delete and Add',
        load_mode_append: 'Append',
        load_mode_rename_add: 'Rename and Add',
        load_mode_reset: 'Reset and Load',
        load_progress_working: 'processing...',
        load_progress_done: 'Completed!',
        load_error_invalid: 'Failed to load JSON. Please check the format.',
        load_error_log: 'JSON Load Error:',
        mode_overwrite: 'Delete and re-add category if it already exists',
        mode_append: 'If the category exists, add images to it (no duplicate check)',
        mode_rename_add: 'If the category exists, rename it and add (e.g., _2)',
        mode_reset: 'Clear all categories and load the JSON data',
        image_upload_no_category: 'No category selected',
        image_upload_aborted: 'Aborted',
        image_upload_processing: 'processing…',
        image_upload_done: 'Done!',
        image_upload_hint: 'Click here or drop images anywhere on the page to upload',
        image_upload_drag_info1: 'You can also drag and drop images shown in your browser.',
        image_upload_drag_info2: 'The entire page is a drop zone, not just the box.',
        image_display_count: 'Items per page:',
        image_sort_order: 'Sort order:',
        sort_asc: 'Ascending',
        sort_desc: 'Descending',
        prev_page: 'Prev',
        next_page: 'Next',
        upload_success_suffix: 'images added',
        upload_error_suffix: 'images failed to add',
        image_display_finished: 'Finished', // en
        header_old_version: 'Classic Version',
        feedback_label: 'Bug Report / Feedback',
        header_document: 'Documentation',
        doc_title: 'How to Add Images in Category Management',
        doc_intro: 'You can easily add images by dropping them in. This page introduces two main methods.',
        doc_drop_browser_title: 'Drop Images from Browser',
        doc_drop_browser_desc: 'Drag and drop images displayed in your browser one by one into the category management screen.',
        doc_drop_local_title: 'Bulk Add from Local Folder',
        doc_drop_local_desc: 'Select multiple image files from a folder and drag & drop them into the category management screen to add them all at once.',
        doc_drop_zone_title: 'Entire Page as Drop Zone',
        doc_drop_zone_desc: 'You can drop images anywhere on the category management page. The drop area is shown for convenience only.',
        doc_video_fallback: 'Your browser does not support the video tag.',
        doc_play_controls_title: 'Playback Screen Buttons',
        doc_play_prev: 'Back: Return to the previous image.',
        doc_play_next: 'Next: Proceed to the next image.',
        doc_play_pause: 'Play / Pause: Pause or resume the current image display.',
        doc_play_reset: 'Reset: Reset the playback and return to the beginning.',
        doc_play_flip_x: 'Flip (Horizontal): Flip the image horizontally.',
        doc_play_flip_y: 'Flip (Vertical): Flip the image vertically.',
        doc_play_filter: 'Filter: Apply effects like grayscale, sepia, and brightness adjustment.',
        doc_play_delete: 'Delete: Remove the currently displayed image. It will not be included when saving category data.',
        doc_wait_title: 'Waiting Screen Settings',
        doc_wait_timer: 'Timer (min:sec): Set image display duration freely in minutes and seconds.',
        doc_wait_count: 'Number of Images: Show the specified number of images.',
        doc_wait_countdown: 'Countdown: Show a countdown while each image is displayed.',
        doc_wait_shuffle: 'Shuffle Playback: Randomize the playback order.',
        doc_wait_keyboard: 'Keyboard Controls: Press Space or Enter to pause/resume, use ←→ to navigate, and press Esc to reset and return to the waiting screen.',
        doc_wait_tap: 'Tap Controls: The screen is divided into thirds—left to go back, center to pause/play, right to go forward. The tap areas scale automatically with screen width.',
        doc_wait_bell: '10-Second Warning Sound: A small bell sounds when the timer reaches 10 seconds remaining.',
        doc_features_title: 'Feature Overview',
        doc_features_pin: 'Pin: Pin frequently used categories to the top for quick access.',
        doc_features_export: 'Export Category Data: Export all current categories and image data as a JSON file.',
        doc_features_import: 'Import Category Data: Load a JSON file to restore category and image data.',
        doc_features_add: 'Add Category: Create new categories freely.',
        doc_features_dedup: 'Remove Duplicates: Automatically remove duplicate images.',

    },
};

// ✅ 翻訳関数
export function t(key: keyof typeof i18n['ja']) {
    return i18n[lang()][key];
}
